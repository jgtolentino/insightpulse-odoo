version: 1
metadata:
  created: 2026-02-05
  description: Single Source of Truth for InsightPulse Odoo system design and architecture
  maintainers:
    - devops-team
    - data-engineering-team
    - backend-team

domains:
  1_system_design_fundamentals:
    description: Core architectural patterns and design decisions
    stack:
      - Odoo 18 CE (ERP core)
      - PostgreSQL 15 (primary database)
      - Docker Compose (containerization)
      - Nginx (reverse proxy)
      - Caddy (TLS termination)
    owners:
      - devops-team
      - backend-team
    patterns:
      - Microservices architecture
      - Event-driven workflows
      - API-first design
    
  2_service_communication:
    description: Inter-service communication patterns and APIs
    stack:
      - XML-RPC (Odoo API)
      - REST APIs (Supabase, n8n)
      - PostgreSQL direct connections
      - Webhooks (GitHub, automation)
    owners:
      - backend-team
      - integration-team
    patterns:
      - Synchronous RPC calls
      - Asynchronous webhooks
      - Database-level CDC (Change Data Capture)
    
  3_load_balancing_traffic:
    description: Traffic management and load distribution
    stack:
      - Nginx (load balancing)
      - Caddy (automatic HTTPS)
      - DigitalOcean App Platform (managed LB)
    owners:
      - devops-team
      - sre-team
    patterns:
      - Round-robin load balancing
      - Health check endpoints
      - Automatic failover
    
  4_database_storage:
    description: Database architecture and storage solutions
    stack:
      - PostgreSQL 15 (Odoo primary)
      - Supabase PostgreSQL (analytics warehouse)
      - DigitalOcean Managed Postgres (production)
      - MinIO (object storage)
    owners:
      - data-engineering-team
      - backend-team
    patterns:
      - Master-replica replication
      - Connection pooling (PgBouncer)
      - Automated backups (daily)
      - PITR (Point-in-Time Recovery)
    
  5_caching_cdn:
    description: Caching strategies and content delivery
    stack:
      - Redis (session cache)
      - Nginx proxy cache
      - Browser caching (static assets)
    owners:
      - devops-team
      - frontend-team
    patterns:
      - "Multi-level caching (L1: Redis, L2: Nginx)"
      - Cache invalidation strategies
      - Static asset CDN
    
  6_scalability_fault_tolerance:
    description: Scaling strategies and fault tolerance mechanisms
    stack:
      - Docker Swarm (future: horizontal scaling)
      - PostgreSQL replication
      - Automated backups
      - Health monitoring
    owners:
      - devops-team
      - sre-team
    patterns:
      - Horizontal scaling (containers)
      - Database read replicas
      - Graceful degradation
      - Circuit breaker pattern
    
  7_observability_monitoring:
    description: Monitoring, logging, and observability infrastructure
    stack:
      - Structured logs (JSON format)
      - Health check endpoints (/health)
      - Superset dashboards
      - GitHub Actions monitoring
    owners:
      - sre-team
      - devops-team
    patterns:
      - Centralized logging
      - Metrics collection
      - Distributed tracing (correlation IDs)
      - Alerting (email, webhooks)
    requirements:
      - Health endpoints for all services
      - JSON structured logs
      - Correlation IDs for requests
      - Alert thresholds defined
    
  8_security_reliability:
    description: Security controls and reliability measures
    stack:
      - GitHub Secrets (CI/CD secrets)
      - Supabase Vault (edge function secrets)
      - Environment files (DO droplet secrets)
      - Let's Encrypt (TLS certificates)
    owners:
      - security-team
      - devops-team
    patterns:
      - No secrets in git
      - Automated secret rotation
      - TLS everywhere
      - Row-level security (RLS)
    requirements:
      - All secrets in secure vaults
      - Quarterly secret rotation
      - TLS 1.3 minimum
      - Security headers configured
    
  9_real_world_patterns:
    description: Production deployment patterns and operational procedures
    stack:
      - DigitalOcean droplets (production)
      - GitHub Actions (CI/CD)
      - Supabase (managed services)
      - Backup automation
    owners:
      - devops-team
      - sre-team
    patterns:
      - Blue-green deployments
      - Canary releases
      - Automated rollbacks
      - Disaster recovery drills
    procedures:
      - Daily automated backups
      - Quarterly restore drills
      - Monthly security patches
      - On-demand scaling

operational:
  backup_schedule:
    odoo_database: daily-3am-utc
    supabase: continuous-pitr
    file_storage: daily-4am-utc
  
  restore_targets:
    rpo: 24-hours  # Recovery Point Objective
    rto: 4-hours   # Recovery Time Objective
  
  monitoring_thresholds:
    cpu_warning: 70
    cpu_critical: 85
    memory_warning: 75
    memory_critical: 90
    disk_warning: 80
    disk_critical: 90
    response_time_warning: 2000  # ms
    response_time_critical: 5000  # ms
  
  required_health_endpoints:
    - service: odoo
      path: /health
      expected: 200
    - service: supabase
      path: /rest/v1/
      expected: 200
    - service: n8n
      path: /healthz
      expected: 200

compliance:
  standards:
    - Enterprise-grade backups
    - Observability minimum
    - Secrets management
    - Disaster recovery
  
  runbooks_required:
    - Backups and restore drill
    - Observability minimum
    - Secrets management
    - Incident response
    - Service restart procedures
