# Bootstrap Workflow
# First-time setup of SuperClaude framework
# Generates initial skills, creates documentation structure, sets up tools

workflow:
  name: bootstrap
  description: "Initialize SuperClaude framework and generate initial skills"
  version: 1.0.0
  parallel: false  # Sequential execution for setup
  estimated_time: "2 hours"

# Pre-requisites
prerequisites:
  - Git repository initialized
  - Python 3.11+ installed
  - Skills directory exists
  - .superclaude directory exists

# Workflow steps
steps:
  # Step 1: Repository Architecture
  - name: design_structure
    agent: architect
    description: "Design initial repository structure and standards"
    parallel: false

    tasks:
      - task: "Analyze existing repository structure"
        output: .superclaude/shared-context/current-structure.md

      - task: "Design optimal structure for Odoo 19 + AI + BI stack"
        output: docs/architecture/repo-structure.md

      - task: "Create ADR for repository organization"
        output: docs/adr/0001-repository-structure.md

      - task: "Document coding standards"
        output: docs/standards/coding-standards.md

    validation:
      - ADR created with all sections complete
      - Repository structure documented
      - Standards defined

    estimated_time: "30 minutes"

  # Step 2-4: Parallel initialization (AI, Docs, DevOps)
  - name: parallel_initialization
    description: "Initialize AI infrastructure, documentation, and DevOps tools"
    parallel: true  # These can run concurrently

    agents:
      # Sub-step 2a: AI Engineer
      - agent: ai_engineer
        name: setup_librarian
        description: "Setup librarian-indexer and generate initial skills"

        tasks:
          - task: "Test librarian-indexer on existing codebase"
            command: |
              python skills/core/librarian-indexer/suggest-skills.py \
                --codebase custom/ \
                --threshold 500 \
                --output .superclaude/shared-context/skill-suggestions.txt

          - task: "Generate skills for top 5 priority modules"
            command: |
              # Generate skills for complex modules
              for module in $(head -5 .superclaude/shared-context/skill-suggestions.txt); do
                python skills/core/librarian-indexer/auto-generate-skill.py \
                  --module "$module" \
                  --output skills/auto-generated/
              done

          - task: "Index all skills"
            command: |
              python skills/core/librarian-indexer/index-all-skills.py \
                --skills-dir skills/ \
                --output skills/INDEX.json

        validation:
          - At least 5 skills generated
          - INDEX.json created
          - README.md generated

        estimated_time: "30 minutes"

      # Sub-step 2b: Documentation Writer
      - agent: doc_writer
        name: create_docs_structure
        description: "Create documentation structure and initial README"

        tasks:
          - task: "Create docs directory structure"
            files:
              - docs/architecture/
              - docs/adr/
              - docs/runbooks/
              - docs/guides/
              - docs/api/

          - task: "Create main README.md"
            output: README.md
            template: |
              # InsightPulse Odoo 19.0 Finance SSC

              Multi-agency Finance Shared Service Center with AI automation

              ## Features
              - Odoo 19.0 Enterprise (OCA-compliant)
              - Apache Superset BI dashboards
              - AI/LLM automation (PaddleOCR, RAG)
              - Multi-agency workflows (8 agencies)
              - Philippine BIR compliance

              ## Quick Start
              ```bash
              make init      # First-time setup
              make dev       # Start development
              ```

              ## Documentation
              - [Architecture](docs/architecture/)
              - [ADRs](docs/adr/)
              - [Runbooks](docs/runbooks/)

          - task: "Create CONTRIBUTING.md"
            output: CONTRIBUTING.md

          - task: "Create runbook template"
            output: docs/runbooks/template.md

        validation:
          - README.md created
          - Docs structure exists
          - Templates available

        estimated_time: "20 minutes"

      # Sub-step 2c: DevOps Engineer
      - agent: devops
        name: create_makefile_and_tools
        description: "Create Makefile and initial IaC templates"

        tasks:
          - task: "Generate Makefile with SuperClaude commands"
            output: Makefile
            template: |
              # Auto-generated Makefile with SuperClaude integration
              # Project: insightpulse-odoo

              .PHONY: help init dev test deploy superclaude-*

              help: ## Show this help
                  @grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-30s\033[0m %s\n", $$1, $$2}'

              # === SETUP ===
              init: ## Initialize project (first-time setup)
                  @echo "üöÄ Running SuperClaude bootstrap workflow..."
                  python .superclaude/orchestrate.py --workflow bootstrap
                  @echo "‚úÖ Bootstrap complete!"

              # === DEVELOPMENT ===
              dev: ## Start development environment
                  docker-compose up -d
                  @echo "üåê Odoo: http://localhost:8069"

              # === SUPERCLAUDE COMMANDS ===
              superclaude-bootstrap: ## Bootstrap SuperClaude framework
                  python .superclaude/orchestrate.py --workflow bootstrap

              superclaude-build-ai: ## Build AI infrastructure (parallel)
                  python .superclaude/orchestrate.py --workflow build_ai_infrastructure --parallel

              superclaude-build-all: ## Build entire system (parallel, 5 agents)
                  python .superclaude/orchestrate.py --workflow build_full_stack --parallel --agents all

              # === SKILLS ===
              skill-generate: ## Auto-generate skills from code
                  python skills/core/librarian-indexer/auto-generate-skill.py --module $$MODULE --output $$OUTPUT

              skill-index: ## Rebuild skill index
                  python skills/core/librarian-indexer/index-all-skills.py

              skill-suggest: ## Suggest new skills
                  python skills/core/librarian-indexer/suggest-skills.py --codebase custom/

          - task: "Create Docker Compose template"
            output: infrastructure/docker/docker-compose.template.yml

          - task: "Create GitHub Actions workflow template"
            output: .github/workflows/superclaude-ci.template.yml

        validation:
          - Makefile created and tested
          - Templates available
          - Commands executable

        estimated_time: "20 minutes"

  # Step 5: Final validation and summary
  - name: finalize
    agent: architect
    description: "Validate bootstrap and create summary"
    parallel: false

    tasks:
      - task: "Validate all outputs"
        validation:
          - Check all files created
          - Verify skills indexed
          - Test Makefile commands
          - Validate documentation

      - task: "Create bootstrap summary"
        output: .superclaude/shared-context/bootstrap-summary.md
        content: |
          # Bootstrap Summary

          Completed: {timestamp}

          ## Outputs Created
          - {file_count} files
          - {skill_count} skills generated
          - {doc_count} documentation pages

          ## Next Steps
          1. Review generated skills: `cat skills/INDEX.json`
          2. Test Makefile: `make help`
          3. Start development: `make dev`
          4. Build AI infrastructure: `make superclaude-build-ai`

      - task: "Commit bootstrap results"
        command: |
          git add .superclaude/ skills/ docs/ Makefile
          git commit -m "ü§ñ Bootstrap SuperClaude framework

          Generated by SuperClaude bootstrap workflow.

          - Created 5 agent definitions
          - Generated {skill_count} initial skills
          - Setup documentation structure
          - Created Makefile with SuperClaude commands

          Co-Authored-By: SuperClaude <superclaude@insightpulse.ai>"

    estimated_time: "10 minutes"

# Post-workflow actions
post_workflow:
  notifications:
    - type: console
      message: |
        ‚úÖ Bootstrap complete!

        üìä Summary:
           - Skills generated: {skill_count}
           - Documentation created: {doc_count}
           - Agent definitions: 5
           - Workflows available: 3

        üöÄ Next commands:
           make help                    # Show all commands
           make superclaude-build-ai    # Build AI infrastructure
           make superclaude-build-all   # Build entire system in parallel

  shared_context_updates:
    - key: bootstrap_completed
      value: true
    - key: bootstrap_timestamp
      value: "{timestamp}"
    - key: skills_count
      value: "{skill_count}"

# Error handling
error_handling:
  on_failure:
    action: rollback
    notify: true
    cleanup:
      - Remove incomplete files
      - Reset shared context
      - Log error details

  retry_policy:
    max_attempts: 3
    backoff: exponential

# Success criteria
success_criteria:
  - At least 5 skills generated
  - Makefile created and working
  - Documentation structure exists
  - All validation checks pass
  - Git commit successful
