====================
IPAI PPM Cost Sheets
====================

..
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! source digest: sha256:d41d8cd98f00b204e9800998ecf8427e

.. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
    :target: https://odoo-community.org/page/development-status
    :alt: Beta
.. |badge2| image:: https://img.shields.io/badge/licence-LGPL--3-blue.png
    :target: http://www.gnu.org/licenses/lgpl-3.0-standalone.html
    :alt: License: LGPL-3
.. |badge3| image:: https://img.shields.io/badge/github-insightpulseai%2Finsightpulse--odoo-lightgray.png?logo=github
    :target: https://github.com/insightpulseai/insightpulse-odoo/tree/19.0/addons/custom/ipai_ppm_costsheet
    :alt: insightpulseai/insightpulse-odoo

|badge1| |badge2| |badge3|

Vendor-privacy cost sheet management system with role-based rate visibility. Account Managers see role-based rates only, while Finance Directors see actual vendor costs and profit margins.

Part of InsightPulse Enterprise SaaS Parity **Epic 2** (Clarity PPM + SAP Ariba Parity).

**Table of contents**

.. contents::
   :local:

Features
========

* **Role-Based Rate Visibility**: Different users see different rate information based on security groups
* **Vendor Privacy Protection**: Actual vendor costs hidden from Account Managers
* **Automated Rate Calculation**: P60 base rates + configurable markup percentage (default 25%)
* **Cost Sheet Templates**: Pre-built templates with role matrices for common project types
* **Real-Time Profit Margin Tracking**: Live calculation of profit margins on cost sheets
* **Budget vs Actual Analysis**: Track cost overruns and underruns with variance analysis
* **Multi-Currency Support**: Handle international projects with automatic currency conversion
* **Export to Excel/PDF**: Generate professional cost sheet reports for clients
* **Integration with Projects**: Seamless link to project management and timesheets
* **Analytics Dashboard**: Profitability analysis by project, client, and resource type

Configuration
=============

After installation:

1. Go to **Settings → Users & Companies → Groups** and assign:
   - **Account Manager** group: Can view role-based rates
   - **Finance Director** group: Can view actual costs and margins
2. Configure rate cards: **Project → Configuration → Rate Cards**
3. Set default markup percentage: **Settings → Technical → Parameters** (key: ``ipai_ppm.default_markup``)
4. Create cost sheet templates: **Project → Configuration → Cost Sheet Templates**

Usage
=====

Creating a Cost Sheet
---------------------

1. Navigate to **Project → Cost Sheets → Create**
2. Select Project and Client
3. Click **Load Template** to use pre-built role matrix
4. Or manually add cost sheet lines with:
   - Resource (employee or role)
   - Base Rate (P60 or custom)
   - Quantity/Hours
   - Markup Percentage
5. System automatically calculates:
   - Total Cost
   - Client Rate
   - Profit Margin
6. Click **Validate** to lock cost sheet

Role-Based Visibility Example
------------------------------

For the same cost sheet:

**Account Manager View**:

.. code-block:: text

    Resource         | Role         | Client Rate | Hours | Total
    -----------------|--------------|-------------|-------|--------
    John Doe         | Developer    | ₱3,750/hr   | 160   | ₱600,000
    Jane Smith       | PM           | ₱4,375/hr   | 80    | ₱350,000

    Total: ₱950,000

**Finance Director View**:

.. code-block:: text

    Resource         | Role         | Base Rate | Markup | Client Rate | Hours | Profit
    -----------------|--------------|-----------|--------|-------------|-------|--------
    John Doe         | Developer    | ₱3,000/hr | 25%    | ₱3,750/hr   | 160   | ₱120,000
    Jane Smith       | PM           | ₱3,500/hr | 25%    | ₱4,375/hr   | 80    | ₱70,000

    Total Cost: ₱760,000 | Total Revenue: ₱950,000 | Profit: ₱190,000 (25%)

Automated Rate Calculation
---------------------------

Rates are calculated using the formula:

.. code-block:: python

    client_rate = base_rate * (1 + markup_percent / 100)

Example:
- Base Rate: ₱3,000/hr (P60 median developer rate)
- Markup: 25%
- Client Rate: ₱3,000 × 1.25 = ₱3,750/hr

Budget vs Actual Tracking
--------------------------

1. Create Cost Sheet with budgeted hours
2. As team logs time in Timesheets, actual hours populate
3. System calculates:
   - Variance: Actual - Budget
   - Variance %: (Variance / Budget) × 100
   - At-risk indicator if variance > threshold
4. Generate variance reports: **Project → Reports → Budget Variance Analysis**

Multi-Currency Support
----------------------

1. Set project currency: **Project → Edit → Currency**
2. Base rates stored in company currency (PHP)
3. Client rates converted to project currency automatically
4. Exchange rates updated daily from ECB or manual entry
5. Cost sheets export in project currency

Export Options
--------------

**Excel Export**:
- Full cost breakdown with formulas
- Charts for profit margin trends
- Client-friendly template (no vendor costs)
- Internal template (with actual costs)

**PDF Export**:
- Professional letterhead
- Role-based filtering applied
- Signature lines for approval
- Multiple formats: Summary, Detailed, Comparison

Technical Details
=================

**Models**:

* ``cost.sheet`` - Main cost sheet document
* ``cost.sheet.line`` - Individual cost line items (resources)
* ``cost.sheet.template`` - Reusable templates with role matrices
* ``rate.card`` - Rate definitions by role and seniority

**Security**:

* ``security/security_groups.xml`` - Defines Account Manager and Finance Director groups
* ``security/record_rules.xml`` - Row-level security for rate visibility
* ``ir.rule`` for ``cost.sheet.line`` filters ``base_rate`` field based on user group

**Views**:

* ``views/cost_sheet_views.xml`` - Main cost sheet forms and lists
* ``views/cost_sheet_line_views.xml`` - Line item details (conditional visibility)
* ``views/rate_card_views.xml`` - Rate card management
* ``report/cost_sheet_report.xml`` - QWeb reports for PDF export

**Queue Jobs**:

* ``calculate_profit_margins`` - Batch recalculation of margins when rates change
* ``export_cost_sheet_excel`` - Asynchronous Excel generation for large cost sheets
* ``sync_actual_hours`` - Update actual hours from timesheets hourly

Known Issues / Roadmap
======================

* Multi-currency conversion requires manual exchange rate updates (auto-sync planned for v2)
* Excel export limited to 1000 lines (pagination planned for v2)
* Profit margin alerts not yet implemented (webhook integration planned)

Bug Tracker
===========

Bugs are tracked on `GitHub Issues <https://github.com/insightpulseai/insightpulse-odoo/issues>`_.
In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us to smash it by providing a detailed and welcomed
`feedback <https://github.com/insightpulseai/insightpulse-odoo/issues/new?body=module:%20ipai_ppm_costsheet%0Aversion:%2019.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.

Do not contact contributors directly about support or help with technical issues.

Credits
=======

Authors
-------

* InsightPulse

Contributors
------------

* Jake Tolentino <jgtolentino_rn@yahoo.com>

Maintainers
-----------

This module is maintained by InsightPulseAI.

.. image:: https://insightpulseai.net/logo.png
   :alt: InsightPulseAI
   :target: https://insightpulseai.net

InsightPulseAI is a Finance Shared Service Center automation platform built on Odoo 19.0, providing enterprise SaaS parity for Clarity PPM, SAP Ariba, and Tableau workflows.

This module is part of the `insightpulseai/insightpulse-odoo <https://github.com/insightpulseai/insightpulse-odoo/tree/19.0/addons/custom/ipai_ppm_costsheet>`_ project on GitHub.

You are welcome to contribute.
