==============
IPAI Approvals
==============

..
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! This file is generated by oca-gen-addon-readme !!
   !! changes will be overwritten.                   !!
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !! source digest: sha256:d41d8cd98f00b204e9800998ecf8427e

.. |badge1| image:: https://img.shields.io/badge/maturity-Beta-yellow.png
    :target: https://odoo-community.org/page/development-status
    :alt: Beta
.. |badge2| image:: https://img.shields.io/badge/licence-LGPL--3-blue.png
    :target: http://www.gnu.org/licenses/lgpl-3.0-standalone.html
    :alt: License: LGPL-3
.. |badge3| image:: https://img.shields.io/badge/github-insightpulseai%2Finsightpulse--odoo-lightgray.png?logo=github
    :target: https://github.com/insightpulseai/insightpulse-odoo/tree/19.0/addons/custom/ipai_approvals
    :alt: insightpulseai/insightpulse-odoo

|badge1| |badge2| |badge3|

Unified approval workflow system providing multi-level approvals for Purchase Orders, Expense Reports, and Invoices with automated routing, escalation handling, and complete audit trails.

Part of InsightPulse Enterprise SaaS Parity **Epic 1** (Clarity PPM Parity).

**Table of contents**

.. contents::
   :local:

Features
========

* **Purchase Order Approvals**: Multi-level approval chains based on amount thresholds
* **Expense Approvals**: Manager → Finance → Director approval flows with policy validation
* **Invoice Approvals**: Vendor bill approvals with 3-way matching
* **Custom Approval Rules**: Configurable rules based on amount, category, department, or agency
* **Automated Routing**: Intelligent approval routing based on organizational hierarchy
* **Escalation Handling**: Automatic escalation to next approver after timeout
* **Chatter Integration**: Complete approval history in document threads
* **Activity Tracking**: Automatic activity creation and reminders for approvers
* **Queue Job Integration**: Asynchronous approval processing for high-volume scenarios
* **Email Notifications**: Automated emails to approvers with direct action links

Configuration
=============

After installation:

1. Go to **Settings → Technical → Approval Flows** to create approval chains
2. Configure approval rules: **Settings → Technical → Approval Rules**
3. Set amount thresholds and approval levels
4. Assign approvers by department, agency, or role

Example Approval Flow Configuration:

.. code-block:: xml

    <record id="flow_purchase_order" model="approval.flow">
        <field name="name">Purchase Order Approval</field>
        <field name="model_id" ref="purchase.model_purchase_order"/>
        <field name="level_1_amount">10000</field>
        <field name="level_1_approver_id" ref="base.user_demo"/>
        <field name="level_2_amount">50000</field>
        <field name="level_2_approver_id" ref="base.user_admin"/>
        <field name="escalation_timeout">24</field>
    </record>

Usage
=====

Purchase Order Approvals
-------------------------

1. Create a Purchase Order as usual
2. Click **Submit for Approval** when ready
3. Purchase Order status changes to "Pending Approval"
4. Assigned approver receives notification and activity
5. Approver clicks **Approve** or **Reject** from email or within Odoo
6. If approved, PO proceeds to next approval level or to "Approved" state
7. If rejected, PO returns to "Draft" with rejection reason in Chatter

Expense Approvals
-----------------

1. Employee submits Expense Report
2. System automatically routes to Manager for Level 1 approval
3. If amount > threshold, routes to Finance for Level 2 approval
4. If amount > higher threshold, routes to Director for Level 3 approval
5. Each approval creates activity and posts message in Chatter
6. Once fully approved, expense proceeds to payment processing

Invoice Approvals
-----------------

1. Vendor bill is created (manually or via email)
2. If 3-way matching enabled, system validates PO line items
3. Bill is submitted for approval
4. Routed based on amount and department
5. Approvers validate bill accuracy and approve/reject
6. Approved bills proceed to payment run

Custom Approval Rules
---------------------

Create custom rules for specific scenarios:

.. code-block:: python

    # Example: Require CEO approval for international purchases
    from odoo import models, api

    class PurchaseOrder(models.Model):
        _inherit = 'purchase.order'

        @api.model
        def _get_approval_rule(self):
            if self.partner_id.country_id != self.company_id.country_id:
                return self.env.ref('ipai_approvals.rule_ceo_international')
            return super()._get_approval_rule()

Technical Details
=================

**Models**:

* ``approval.flow`` - Defines approval chain structure
* ``approval.rule`` - Configurable approval routing rules
* ``approval.history`` - Complete audit trail of approval actions

**Mixins**:

* ``approval.mixin`` - Provides ``start_approval_flow()``, ``approve()``, ``reject()`` methods

**Queue Jobs**:

* ``process_approval_request`` - Asynchronous approval processing
* ``send_approval_notification`` - Email notification delivery
* ``escalate_approval`` - Timeout-based escalation to next approver

**Security Groups**:

* ``group_approval_user`` - Can submit documents for approval
* ``group_approval_manager`` - Can approve Level 1 requests
* ``group_approval_director`` - Can approve Level 2+ requests
* ``group_approval_admin`` - Can configure approval flows and rules

Bug Tracker
===========

Bugs are tracked on `GitHub Issues <https://github.com/insightpulseai/insightpulse-odoo/issues>`_.
In case of trouble, please check there if your issue has already been reported.
If you spotted it first, help us to smash it by providing a detailed and welcomed
`feedback <https://github.com/insightpulseai/insightpulse-odoo/issues/new?body=module:%20ipai_approvals%0Aversion:%2019.0%0A%0A**Steps%20to%20reproduce**%0A-%20...%0A%0A**Current%20behavior**%0A%0A**Expected%20behavior**>`_.

Do not contact contributors directly about support or help with technical issues.

Credits
=======

Authors
-------

* InsightPulse

Contributors
------------

* Jake Tolentino <jgtolentino_rn@yahoo.com>

Maintainers
-----------

This module is maintained by InsightPulseAI.

.. image:: https://insightpulseai.net/logo.png
   :alt: InsightPulseAI
   :target: https://insightpulseai.net

InsightPulseAI is a Finance Shared Service Center automation platform built on Odoo 19.0, providing enterprise SaaS parity for Clarity PPM, SAP Ariba, and Tableau workflows.

This module is part of the `insightpulseai/insightpulse-odoo <https://github.com/insightpulseai/insightpulse-odoo/tree/19.0/addons/custom/ipai_approvals>`_ project on GitHub.

You are welcome to contribute.
