version: '3.8'

services:
  # Main services orchestration
  # For detailed service configurations, see infrastructure/docker/

  odoo:
    image: odoo:18.0
    depends_on:
      - postgres
    ports:
      - "8069:8069"
      - "8072:8072"  # Longpolling port for real-time features
    environment:
      - HOST=postgres
      - USER=odoo
      - PASSWORD=odoo
      - HTTP_PORT=8069
      - LONGPOLLING_PORT=8072
    volumes:
      # Custom InsightPulse modules (new structure)
      - ./addons:/mnt/addons:ro

      # OCA modules (git submodules - to be populated)
      - ./addons/oca:/mnt/oca:ro

      # Configuration
      - ./odoo.conf:/etc/odoo/odoo.conf:ro

      # Persistent data
      - odoo_data:/var/lib/odoo

  postgres:
    image: postgres:15
    environment:
      - POSTGRES_DB=odoo
      - POSTGRES_USER=odoo
      - POSTGRES_PASSWORD=odoo
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
  odoo_data:
