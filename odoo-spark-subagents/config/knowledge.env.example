# ==============================================================================
# Knowledge System Configuration
# ==============================================================================
# This file configures the knowledge-first automation infrastructure.
# Copy to .env and fill in your production values.

# --- Supabase / Knowledge Graph ---
# Your Supabase project URL (e.g., https://abc123.supabase.co)
SUPABASE_URL=https://your-project-id.supabase.co

# Service role key for server-side operations (has full access)
# WARNING: Keep this secret! Never commit to git.
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here

# Anon key for client-side operations (limited access via RLS)
SUPABASE_ANON_KEY=your-anon-key-here

# Schema name for knowledge tables (default: public)
SUPABASE_KNOWLEDGE_SCHEMA=public

# Optional: PostgreSQL connection pooling
KNOWLEDGE_DB_POOL_SIZE=10
KNOWLEDGE_DB_POOL_MIN_SIZE=2
KNOWLEDGE_DB_POOL_TIMEOUT_SEC=30
KNOWLEDGE_DB_STATEMENT_TIMEOUT_MS=5000

# --- Knowledge Scraper Configuration ---
# How many documents to process in a single batch
KNOWLEDGE_SCRAPER_BATCH_SIZE=200

# Maximum pages to scrape per run (prevent runaway scraping)
KNOWLEDGE_SCRAPER_MAX_PAGES=1000

# Rate limiting: seconds to wait between requests
KNOWLEDGE_SCRAPER_RATE_LIMIT_SEC=0.5

# Which sources to enable (comma-separated: docs,forum,github)
KNOWLEDGE_SCRAPER_SOURCES=docs,forum,github

# --- Skill Harvester Configuration ---
# Minimum successful runs before a pattern qualifies as a skill
KNOWLEDGE_SKILL_MIN_SUCCESS_COUNT=3

# Minimum confidence score to harvest a skill
KNOWLEDGE_SKILL_MIN_CONFIDENCE=0.75

# Maximum complexity (number of steps) for skill patterns
KNOWLEDGE_SKILL_MAX_STEPS=20

# Auto-publish harvested skills without human review
KNOWLEDGE_AUTO_SKILL_PUBLISH_ENABLED=true

# --- Error Learner Configuration ---
# How many days to look back for error patterns
KNOWLEDGE_ERROR_LOOKBACK_DAYS=7

# Minimum similarity threshold for error deduplication
KNOWLEDGE_ERROR_SIMILARITY_THRESHOLD=0.85

# Auto-create guardrail skills from errors
KNOWLEDGE_AUTO_ERROR_GUARDRAIL_ENABLED=true

# --- Runtime Integration ---
# Timeout for knowledge client operations (seconds)
KNOWLEDGE_CLIENT_TIMEOUT_SEC=10

# Log level for knowledge system (DEBUG, INFO, WARNING, ERROR)
KNOWLEDGE_CLIENT_LOG_LEVEL=INFO

# Enable auto-learning after each agent run
KNOWLEDGE_AUTO_LEARN_ENABLED=true

# --- OpenAI Configuration ---
# API key for embeddings and skill generation
OPENAI_API_KEY=your-openai-api-key-here

# Model for embeddings
OPENAI_EMBEDDING_MODEL=text-embedding-3-large
OPENAI_EMBEDDING_DIMS=3072

# Model for skill/error generation
OPENAI_LLM_MODEL=gpt-4o
OPENAI_LLM_TEMPERATURE=0.3

# --- GitHub Configuration (for OCA scraping) ---
# Personal access token for GitHub API
GITHUB_TOKEN=your-github-token-here

# --- Observability ---
# OpenTelemetry exporter endpoint
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318

# Enable distributed tracing
KNOWLEDGE_OTEL_ENABLED=true

# Service name for traces
KNOWLEDGE_OTEL_SERVICE_NAME=insightpulse-knowledge

# --- Performance Tuning ---
# Enable embedding caching (Redis recommended for production)
KNOWLEDGE_EMBEDDING_CACHE_ENABLED=false
KNOWLEDGE_EMBEDDING_CACHE_REDIS_URL=redis://localhost:6379

# Batch size for bulk embedding generation
KNOWLEDGE_EMBEDDING_BATCH_SIZE=50

# --- Safety & Limits ---
# Maximum query results to return
KNOWLEDGE_MAX_QUERY_RESULTS=100

# Maximum content length for embeddings (characters)
KNOWLEDGE_MAX_EMBEDDING_LENGTH=8000

# Enable rate limiting for client queries
KNOWLEDGE_CLIENT_RATE_LIMIT_ENABLED=true
KNOWLEDGE_CLIENT_RATE_LIMIT_REQUESTS_PER_MINUTE=60

# --- Development ---
# Enable debug logging for knowledge operations
KNOWLEDGE_DEBUG=false

# Dry-run mode (don't write to database)
KNOWLEDGE_DRY_RUN=false

# Mock OpenAI calls for testing (no API charges)
KNOWLEDGE_MOCK_OPENAI=false
