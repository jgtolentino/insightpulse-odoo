name: odoo-ce-ci

on:
  push:
  pull_request:

jobs:
  guardrails:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: true

      - name: Guardrail – Block Enterprise modules
        run: |
          set -e
          echo "Scanning for Enterprise modules..."
          if grep -Rni "enterprise" addons oca || true; then
            echo "::error::Found references to 'enterprise' in addons/ or oca/ – CE-only policy violated."
            exit 1
          fi
          echo "No Enterprise references found in addons/ or oca/."

      - name: Guardrail – Block odoo.com links
        run: |
          set -e
          echo "Scanning for odoo.com links..."
          if grep -Rni "odoo.com" . || true; then
            echo "::error::Found references to 'odoo.com' – all user-facing links must be InsightPulse or OCA."
            exit 1
          fi
          echo "No odoo.com links found."

      - name: Python lint (optional baseline)
        run: |
          python -m compileall addons || true
