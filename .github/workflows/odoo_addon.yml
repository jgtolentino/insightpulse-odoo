name: odoo-addon
on: [push, pull_request, workflow_dispatch]
jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
      - run: pipx install pylint-odoo flake8-odoo
      - run: pipx run pylint-odoo || true
      - run: pipx run flake8-odoo || true
  package:
    needs: validate
    runs-on: ubuntu-latest
    strategy:
      matrix:
        module:
          - ipai_concur_bridge
          - ipai_ariba_cxml
          - ipai_salesforce_sync
          - ipai_clarity_ppm_sync
          - ipai_statement_engine
          - ipai_consent_manager
          - ipai_doc_ai
          - ipai_visual_gate
    steps:
      - uses: actions/checkout@v4
      - run: bash scripts/odoo/package_addon.sh ${{ matrix.module }} dist
      - uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.module }}
          path: dist/**
